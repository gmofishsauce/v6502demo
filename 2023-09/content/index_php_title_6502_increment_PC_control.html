<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en">
<head>
<title>6502 increment PC control - VisualChips</title>
</head>
<body>
		<!-- start content -->
<p>The 6502 Program Counter has a dedicated incrementer which has to be able to increment across 16 bits in a single cycle.
</p><p>It (almost) always increments during an instruction fetch cycle, to fetch a possible operand, but in general the decision whether or not to increment is a complex one.  The exception to incrementing during fetch is <a href="https://web.archive.org/web/20210405071441/http://visual6502.org/JSSim/expert.html?graphics=f&amp;loglevel=2&amp;steps=30&amp;logmore=nmi,379,sync&amp;nmi0=20" class="external text" rel="nofollow">illustrated here</a> - in the cycle when an interrupt is recognised, the instruction fetch occurs but the instruction is ignored and the PC increment is suppressed in order that the PC value can be stacked.
</p><p>As it happens, some of the logic implementing that decision is absent from Balazs' schematic, probably because of a bad patch in the die photograph.  It also happens to use some unusual NMOS logic techniques.
</p><p>Here's the layout, as rendered by <a href="https://web.archive.org/web/20210405071441/http://visual6502.org/JSSim/expert.html?nosim=t&amp;find=short-circuit-branch-add,379&amp;panx=381.0&amp;pany=284.0&amp;zoom=8.0" class="external text" rel="nofollow">visual6502's JSSim</a>:
</p><p><a href="/web/20210405071441/http://visual6502.org/wiki/index.php?title=File:6502-ipc-layout.png" class="image"><img alt="6502-ipc-layout.png" src="/web/20210405071441im_/http://visual6502.org/wiki/images/b/b2/6502-ipc-layout.png" width="685" height="621"/></a>
</p><p>The highlighted signal bottom centre is the negative-sense signal "dpc36_#IPC", and the highlighted signal near the middle is "short-circuit-branch-add"
</p><p>Here's a diagram of the final few logic stages, which react to page-crossing branches, taken branches, single-byte instructions, interrupt handing (D1x1) and stalled cycles (use of RDY):
</p><p><a href="/web/20210405071441/http://visual6502.org/wiki/index.php?title=File:6502-ipc-logic.png" class="image"><img alt="6502-ipc-logic.png" src="/web/20210405071441im_/http://visual6502.org/wiki/images/5/58/6502-ipc-logic.png" width="640" height="343"/></a>
</p><p>Note that the exclusive OR is implemented as a modified multiplexor which includes the subsequent AND function. The modification ensures that the AND's pulldown doesn't affect the signal notALUcout (node 206) which is used elsewhere, by pulling it down through the multiplexor's pass transistors.
</p><p>Here's a transistor level view covering most of the same circuit:
</p><p><a href="/web/20210405071441/http://visual6502.org/wiki/index.php?title=File:6502-ipc-circuit.png" class="image"><img alt="6502-ipc-circuit.png" src="/web/20210405071441im_/http://visual6502.org/wiki/images/7/75/6502-ipc-circuit.png" width="800" height="260"/></a>
</p>
<!-- 
NewPP limit report
Preprocessor node count: 1/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key wiki6502:pcache:idhash:133-0!1!0!!en!2!edit=0 and timestamp 20210405071441 -->
<div class="printfooter">
Retrieved from "<a href="https://web.archive.org/web/20210405071441/http://visual6502.org/wiki/index.php?title=6502_increment_PC_control">http://visual6502.org/wiki/index.php?title=6502_increment_PC_control</a>"</div>
		<div id="catlinks" class="catlinks catlinks-allhidden"></div>		<!-- end content -->
</body>
</html>
<!-- written by getter Thu Sep  7 14:36:11 PDT 2023 -->
